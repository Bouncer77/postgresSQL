# Pattern Matching 

[Pattern Matching - Поиск по шаблону](https://postgrespro.ru/docs/postgrespro/12/functions-matching)

<!-- MarkdownTOC -->

- LIKE
- ILIKE \(PostgresPro\)
- SIMILAR TO Regular Expressions
- substring
	- substring with three arguments
	- substring with two arguments
- regexp_replace
- POSIX Regular Expressions

<!-- /MarkdownTOC -->


## LIKE

LIKE - Поиск текста по шаблону

```sql
строка LIKE шаблон [ESCAPE спецсимвол]
строка NOT LIKE шаблон [ESCAPE спецсимвол]
```

Спецсимвол   | Назначение
:-----------:|----------------------
%            | Означает любую последовательность символов (в том числе пустую)
_            | Означает один любой символ
\            | Спецсимвол для экранирования символов '%' и '_' в строке (Можно заменить: ESCAPE '$')

```sql
SELECT 'abc' LIKE 'abc'; -- true
SELECT 'abc' LIKE 'ADC'; -- false
SELECT 'abc' ILIKE 'ADC'; -- false
SELECT 'abc' LIKE 'a%'; -- true
SELECT 'abc' LIKE '_b_'; -- true
SELECT 'abc' LIKE 'c'; -- false
SELECT 'abc' LIKE '___'; -- true
```

```sql
SELECT '_asdfa' LIKE '\_asd%'; -- true
-- или для экранирования символа '_' можно использовать произвольный символ указанный после слова ESCAPE, например символ '$'
SELECT '_asdfa' LIKE '$_asd%' ESCAPE '$'; -- true
```

## ILIKE (PostgresPro)

ILIKE - Регистро-независимый поиск по шаблону с учётом текущей языковой среды

Оператор в PostgresPro | Описание
-----------------------|----------------------
~~                     | LIKE
~~*                    | ILIKE
!~~                    | OT LIKE
!~~*                   | NOT ILIKE
^@                     | оператор проверки префикса (или воспользоваться функцией starts_with())

```sql
SELECT 'abc' ILIKE 'ABC'; -- true
SELECT 'abc' ILIKE '_B_'; -- true
```

## SIMILAR TO Regular Expressions

SIMILAR TO - шаблоны соответствуют определению регулярных выражений в стандарте SQL

Шаблон по определению в SQL должен соответствовать всей строке, а не только ее части, как в JAVA

```sql
строка SIMILAR TO шаблон [ESCAPE спецсимвол]
строка NOT SIMILAR TO шаблон [ESCAPE спецсимвол]
```

Спецсимвол | Назначение
-----------|-----------------------------------------------------------
\|         | Означает выбор (одного из двух вариантов)
*          | Означает повторение предыдущего элемента 0 и более раз
+          | Означает повторение предыдущего элемента 1 и более раз
?          | Означает вхождение предыдущего элемента 0 или 1 раз
{m}        | Означает повторяет предыдущего элемента ровно m раз
{m,}       | Означает повторение предыдущего элемента m или более раз
{m,n}      | Oзначает повторение предыдущего элемента не менее чем m и не более чем n раз
()         | Объединяют несколько элементов в одну логическую группу
[]         | Обозначают класс символов так же, как и в регулярных выражениях POSIX
\          | Спецсимвол для экранирования символов '%' и '_' в строке (Можно заменить: ESCAPE '$') 

```sql
SELECT 'abc' SIMILAR TO 'abc'; -- true
SELECT 'abc' SIMILAR TO 'a'; -- false
SELECT 'abc' SIMILAR TO '%(b|d)%'; -- true
'abc' SIMILAR TO '(b|c)%'   false
```

## substring 

Функция substring с тремя параметрами производит извлечение подстроки, соответствующей шаблону регулярного выражения SQL.

Указанному шаблону должна соответствовать вся строка; в противном случае функция не найдёт ничего и вернёт NULL

```sql
-- Использует LIKE спецсимволы
substring(строка from шаблон for спецсимвол)
-- <=>
substring(строка, шаблон, спецсимвол)

-- С двумя аргументами поведение функции отличается - используются POSIX спецсимволы
substring(строка from шаблон)
-- <->
substring(строка, шаблон)
```

### substring with three arguments

Строка результата выполнения функции соответствует строке шаблона между разделителями `#"` (спецсимвол + ") в шаблоне, при условии, что строка соответствует шаблону, иначе NULL

```sql
SELECT substring('foobar' from '%#"o_b#"%' for '#'); -- oob
SELECT substring('foobar' from '#"o_b#"%' for '#'); -- NULL

SELECT substring('$.extFields[*].id', '%extFields%.#"%#"', '#'); -- id
```

### substring with two arguments 

Eсли шаблон содержит скобки, она возвращает первое подвыражение, заключённое в скобки

```sql
SELECT substring('test', 'te(.)t'); -- s
SELECT substring('testPrivet', 'te(.*)vet'); -- stPri
```
## regexp_replace

Функция regexp_replace подставляет другой текст вместо подстрок, соответствующих шаблонам регулярных выражений POSIX.

```sql
regexp_replace(исходная_строка, шаблон, замена [, флаги]);
```



## POSIX Regular Expressions

В отличие от шаблонов LIKE, регулярное выражение может совпадать с любой частью строки, если только оно не привязано явно к началу и/или концу строки.

Регулярное выражение — это последовательность символов, представляющая собой краткое определение набора строк (регулярное множество). Строка считается соответствующей регулярному выражению, если она является членом регулярного множества, описываемого регулярным выражением.

Оператор | Обозначение
---------|-----------
.        | Аналог '_' в LIKE
.*       | Аналог '%' в LIKE
~	     | Проверяет соответствие регулярному выражению с учётом регистра	
~*    	 | Проверяет соответствие регулярному выражению без учёта регистра	
!~	     | Проверяет несоответствие регулярному выражению с учётом регистра	
!~*	     | Проверяет несоответствие регулярному выражению без учёта регистра
^        | Начало строки

```sql
SELECT 'Привет thomas, как дела?' ~ '.*thomas.*'; -- true
SELECT 'ThOmaS, это ты? 0_0' ~* '.*thomas.*'; -- true

SELECT 'Кто убил thomas-а!?' !~ '.*Thomas.*'; -- true
SELECT 'Кто убил thomas-а!?' !~ '.*thomas.*'; -- false

SELECT 'Кто убил thomas-а!?' !~* '.*Horos.*'; -- true

SELECT 'abc' ~ '^a'; -- true
SELECT 'abc' ~ '(b|d)'; -- true
```

```sql
'abc' ~ 'abc'    true
'abc' ~ '^a'     true
'abc' ~ '(b|d)'  true
'abc' ~ '^(b|c)' false
```
