# О курсе

### Какие навыки будут получены? 

* общие сведения об архитектуре PostgreSQL
* использование основных объектов БД: таблиц, индексов, представленийпрограммирование на стороне сервера на языках `SQL` и `PL/pgSQL`
* использование основных типов данных, включая записи и массивыорганизация взаимодействия с клиентской частью приложения

### Материалы курса

### Скачать материалы курса

```bash
wget https://edu.postgrespro.ru/DEV1-handouts-12.zip 
unzip -d dev1 DEV1-handouts-12.zip
rm DEV1-handouts-12.zip
```

* основные функции и типы данных (`datatypes.pdf`);
* схема основных таблиц системного каталога с командами psql (`catalogs.pdf`);
* основные команды Unix(`unix_commands.pdf`)

### Скачать PostgeSQL

[Скачать PostgeSQL](https://www.postgresql.org/download/)

### Поддержка кириллицы
При запуске psql рекомендуем выполнять команду chcp 1251, которая настраивает правильное отображение русского языка.

$ `\! chcp 1251`

При запуске pgbench рекомендуем выполнять команду chcp 65001, которая настраивает правильное отображение русского языка.
Предупреждение: не следует запускать psql после команды chcp 65001, в противном случае 8-битовые (русские) символы могут отображаться некорректно.

### Утилиты 

SQL Shell (psql) — основное, «родное» консольное средство управления сервером и выполнения запросов.

### Выполнение команд в среде XUbuntu

Чтобы выполнить команду от имени другого пользователя (например, postgres), выполните:

$`sudo -u postgres команда`

Но обычно бывает удобно открыть второй терминал, один раз выполнить

$`sudo su postgres`

#### Пример использования на XUbuntu

```bash
student:~$ sudo su postgres
ALTER SYSTEM SET work_mem TO '16MB'; // или для сеанса SET work_mem = '64MB';
ALTER SYSTEM RESET work_mem; // установить значение по умолчанию '4MB'
postgres@student:/home/student$ cat /var/lib/postgresql/12/main/postgresql.auto.conf
# Do not edit this file manually!
# It will be overwritten by the ALTER SYSTEM command.
work_mem = '16MB'
postgres@student:/home/student$ pg_ctlcluster 12 main reload // или SELECT pg_reload_conf(); // выполнятся после psql
postgres@student:/home/student$ psql
psql (12.5 (Ubuntu 12.5-1.pgdg20.04+1))
Type "help" for help.
postgres=# SHOW work_mem; 
// или SELECT current_setting('work_mem');
 work_mem 
----------
 16MB
(1 row)
postgres=# \q
```

### При ошибках в курсе 

Будем рады, если вы поделитесь с нами своими замечаниями по адресу 

[edu@postgrespro.ru](edu@postgrespro.ru)

### Расширения 

В состав дистрибутива PostgreSQL входит примерно 50 различных расширений.
Их описание включено в документацию:

[Расширения список](https://postgrespro.ru/docs/postgresql/12/contrib-progСписок) 

[Расширения документация](https://postgrespro.ru/docs/postgresql/12/contrib)

доступных расширений и статус их установки можно посмотреть в представлении `pg_available_extensions`.

### Администрирование сервера

#### Управление сервером

утилита pg_ctl доступ через специальную обертку `pg_ctlcluster`

**Остановить сервер:**
postgres$ `pg_ctlcluster 12 main stop`


**Запустить сервер:**
postgres$ `pg_ctlcluster 12 main start`

**Перезапустить:**

postgres$ `pg_ctlcluster 12 main restart`

**Обновить конфигурацию:**

postgres$ `pg_ctlcluster 12 main reload`

#### Журнал сервера

[Логирование](https://postgrespro.ru/docs/postgresql/12/runtime-config-logging)

### Конфигурационные файлы

#### Список конфигурационных файлов

Имя файла | Путь к файлу            | Способ изменения файла | Описание
----------|-------------------------|-----------------------------
postgresql.conf | /etc/postgresql/12/main/postgresql.conf | Вручную | основной файл параметров 
postgresql.auto.conf | /var/lib/postgresql/12/main/postgresql.auto.conf | команда ALTER SYSTEM | основной файл параметров (с высшим приоритетом, т.е. Параметры, установленные через косанду `ALTER SYSTEM`, имеют приоритет над параметрами в postgresql.conf.


#### Ссылки на доп информацию

[Варианты установки и управления параметрами](https://postgrespro.ru/docs/postgresql/12/config-setting)

[Текущие значения доступны в представлении pg_settings](https://postgrespro.ru/docs/postgresql/12/view-pg-settings)

### Ключевые параметры 

Имя параметра | Описание 
--------------|-------------------------------------------------------
work_mem      | задает объем памяти, который будет использоваться для внутренних операций сортировки и хеш-таблиц, прежде чем будут задействованы временные файлы на диске.

Пример: 

`ALTER SYSTEM SET work_mem TO '16MB';`